<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Language syntax - cgpipe</title> <link rel="shortcut icon" href="/cgpipe/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/cgpipe/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83662616-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-83662616-1'); </script> <script type="text/javascript" src="/cgpipe/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/cgpipe/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Language syntax | cgpipe</title> <meta name="generator" content="Jekyll v3.8.7" /> <meta property="og:title" content="Language syntax" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for the cgpipe project" /> <meta property="og:description" content="Documentation for the cgpipe project" /> <link rel="canonical" href="/cgpipe/docs/syntax" /> <meta property="og:url" content="/cgpipe/docs/syntax" /> <meta property="og:site_name" content="cgpipe" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/cgpipe/docs/syntax","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/cgpipe/assets/img/compgen-cgpipe.png"}},"headline":"Language syntax","description":"Documentation for the cgpipe project","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="/cgpipe/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item "><a href="https://compgen.io/" class="navigation-list-link">Home</a></li><li class="navigation-list-item "><a href="https://compgen.io/projects" class="navigation-list-link">Projects</a></li><li class="navigation-list-item subsite"><a href="/cgpipe/" class="navigation-list-link">Projects: cgpipe</a></li><li class="navigation-list-item subsite_child"><a href="/cgpipe/docs/getting-started" class="navigation-list-link">Getting started</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/cgpipe/docs/getting-started/what-is-cgpipe" class="navigation-list-link">What is cgpipe?</a> <ul class="navigation-list-child-list"><li class="navigation-list-item "><a href="/cgpipe/docs/getting-started/quick" class="navigation-list-link">Quick version</a></li></ul></li><li class="navigation-list-item "><a href="/cgpipe/docs/getting-started/installing" class="navigation-list-link">Installation</a> </li><li class="navigation-list-item "><a href="/cgpipe/docs/getting-started/running" class="navigation-list-link">Running cgpipe</a> </li></ul></li><li class="navigation-list-item subsite_child"><a href="/cgpipe/docs/features" class="navigation-list-link">Features</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/cgpipe/docs/features/job-log" class="navigation-list-link">Job log</a> </li><li class="navigation-list-item "><a href="/cgpipe/docs/features/remote-pipelines" class="navigation-list-link">Remote pipelines</a> </li></ul></li><li class="navigation-list-item active subsite_child"><a href="/cgpipe/docs/syntax" class="navigation-list-link active">Language syntax</a></li><li class="navigation-list-item subsite_child"><a href="/cgpipe/docs/running-jobs" class="navigation-list-link">Job scheduling</a></li><li class="navigation-list-item nav_gap subsite_child"><a href="/cgpipe/docs/tutorials" class="navigation-list-link">Tutorials</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/cgpipe/tutorials/flexible-pipelines" class="navigation-list-link">Tutorial: Flexible pipelines</a> </li><li class="navigation-list-item "><a href="/cgpipe/tutorials/docker-cgpipe" class="navigation-list-link">Tutorial: Docker with cgpipe</a> </li></ul></li><li class="navigation-list-item subsite_child"><a href="https://github.com/compgen-io/cgpipe/releases" class="navigation-list-link">Download</a></li><li class="navigation-list-item nav_gap"><a href="https://compgen.io/contact" class="navigation-list-link">Contact / Help</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4"> <!-- <a href="https://compgen.io/"><img src="assets/img/compgen-icon.png" style="float:left; width: 32px;"/> compgen.io</a><br/>data wrangling for <br/>computational genomics --> <a href="https://compgen.io/" class="footer_link"><img src="/cgpipe//assets/img/compgen-slug.png"/></a> </p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search cgpipe docs" aria-label="Search cgpipe" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="//github.com/compgen-io/cgpipe">View cgpipe on GitHub</a></li> </ul> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <h1 class="no_toc" id="language-syntax"> <a href="#language-syntax" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Language syntax </h1> <p>The cgpipe language has a simple syntax that is similar to many other languages. The flow of a script is also similar to Makefiles.</p> <p>The <a href="https://github.com/compgen-io/cgpipe">source code</a> contains a set of test scripts that have examples of all statements and operations. These test scripts are the definitive source for the language syntax. These tests are run used to verify each build of cgpipe. In any case where this documentation conflicts with the test scripts, the test scripts are correct.</p> <p>Test scripts are available in the <code class="language-plaintext highlighter-rouge">src/test-scripts</code> directory and are named <code class="language-plaintext highlighter-rouge">*.cgpt or *.cgpipe</code>.</p> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#contexts" id="markdown-toc-contexts">Contexts</a></li> <li><a href="#data-types" id="markdown-toc-data-types">Data types</a></li> <li><a href="#variables" id="markdown-toc-variables">Variables</a></li> <li><a href="#lists" id="markdown-toc-lists">Lists</a></li> <li><a href="#math" id="markdown-toc-math">Math</a></li> <li><a href="#logic" id="markdown-toc-logic">Logic</a></li> <li><a href="#variable-substitution" id="markdown-toc-variable-substitution">Variable substitution</a></li> <li><a href="#shell-escaping" id="markdown-toc-shell-escaping">Shell escaping</a></li> <li><a href="#printing" id="markdown-toc-printing">Printing</a></li> <li><a href="#ifelseendif" id="markdown-toc-ifelseendif">If/Else/Endif</a> <ol> <li><a href="#conditions" id="markdown-toc-conditions">Conditions</a></li> </ol> </li> <li><a href="#for-loops" id="markdown-toc-for-loops">For loops</a></li> <li><a href="#build-target-definitions" id="markdown-toc-build-target-definitions">Build target definitions</a> <ol> <li><a href="#wildcards-in-targets" id="markdown-toc-wildcards-in-targets">Wildcards in targets</a></li> <li><a href="#target-substitutions" id="markdown-toc-target-substitutions">Target substitutions</a></li> <li><a href="#special-targets" id="markdown-toc-special-targets">Special targets</a></li> </ol> </li> <li><a href="#including-other-files" id="markdown-toc-including-other-files">Including other files</a></li> <li><a href="#logging" id="markdown-toc-logging">Logging</a></li> <li><a href="#output-logs" id="markdown-toc-output-logs">Output logs</a></li> <li><a href="#comments" id="markdown-toc-comments">Comments</a></li> <li><a href="#help-text" id="markdown-toc-help-text">Help text</a></li> <li><a href="#job-execution-options" id="markdown-toc-job-execution-options">Job execution options</a> <ol> <li><a href="#specifying-the-shell-to-use" id="markdown-toc-specifying-the-shell-to-use">Specifying the shell to use</a></li> <li><a href="#direct-execution-of-jobs" id="markdown-toc-direct-execution-of-jobs">Direct execution of jobs</a></li> </ol> </li> <li><a href="#experimental-cgpipe-language-features" id="markdown-toc-experimental-cgpipe-language-features">Experimental cgpipe language features</a> <ol> <li><a href="#target-snippets-imports" id="markdown-toc-target-snippets-imports">Target snippets imports</a></li> <li><a href="#eval-statement" id="markdown-toc-eval-statement">Eval statement</a></li> <li><a href="#double-evaluated-variables" id="markdown-toc-double-evaluated-variables">Double evaluated variables</a></li> </ol> </li> </ol> <h2 id="contexts"> <a href="#contexts" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Contexts </h2> <p>There are two contexts in a CGPipe pipeline: "global" and "target". In the "global" context, all uncommented lines are evaluated and treated as CGPipe code. The "target" context is how job commands are defined.</p> <p>Within a target context, the code is interpreted in "template" mode, where only areas wrapped in <code class="language-plaintext highlighter-rouge">&lt;% %&gt;</code> are evalutated as CGPipe code. The areas not wrapped in <code class="language-plaintext highlighter-rouge">&lt;% %&gt;</code> are treated as the body of the job script to execute. Any whitespace present in the target body is kept and not stripped. In a target, any print statements will be added to the target body, not written to the console.</p> <p>When a target is defined, it captures the existing global context <em>at definition</em> (like a closure). During execution, target contexts are therefore disconnected from the global context. In practice, this means that a target can read a global variable (if it has been set prior to the build-target definition), however, a target can not set a global variable and have the new value be visible outside or it's own context.</p> <p>A target is defined using the format:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output_file1 {output_file2 ... } : {input_file1 input_file2 ...}
    # indent to establish the target-context
    script body snippet
    &lt;% cgpipe-expression %&gt;
    script body snippet
    script body snippet
    &lt;% 
        cgpipe-expression
        cgpipe-expression
    %&gt;
    ...
# ends with outdent
</code></pre></div></div> <h2 id="data-types"> <a href="#data-types" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Data types </h2> <p>There are 6 primary data types in CGPipe: boolean, float, integer, list, range and string. Booleans are either <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code> (case-sensitive). Strings must be enclosed in double quotes. Lists are initialized using the syntax "[]". Ranges can be used to iterate over a list of numbers using the syntax "from..to".</p> <p>Here are some examples:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo = "Hello world"
foo = 1
foo = 1.0

isvalid = true

list = []
list += "one"
list += "two"

range = 1..10
</code></pre></div></div> <h2 id="variables"> <a href="#variables" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Variables </h2> <p><code class="language-plaintext highlighter-rouge">foo = "val"</code> Set a variable</p> <p><code class="language-plaintext highlighter-rouge">foo ?= "val"</code> Set a variable if it hasn't already been set</p> <p><code class="language-plaintext highlighter-rouge">foo += "val"</code> Append a value to a list (if the variable has already been set, then this will convert that variable to a list)</p> <p><code class="language-plaintext highlighter-rouge">unset foo</code> Unsets a variable. Note: if the variable was used by a target, it will still be set within the context of the target.</p> <p>Variables may also be set at the command-line like this: <code class="language-plaintext highlighter-rouge">cgpipe -foo bar -baz 1 -baz 2</code>. This is the same as saying:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo = "bar"
bar = 2.59
</code></pre></div></div> <h2 id="lists"> <a href="#lists" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Lists </h2> <p>You can also create and access elements in a list using the [] splice operator. List items don't have to be of the same data type, but it is recommended that they are. List indexing starts at zero. Negative indexes are treated as relative to the end of the list.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo = []
foo = [1, 2, "three"]

print foo[2]
&gt;&gt;&gt; "three"
print foo[-1]
&gt;&gt;&gt; "three"
</code></pre></div></div> <p>You can also append to lists:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo = ["foo"]
foo += "bar"
foo += "baz"

print foo
&gt;&gt;&gt; "foo bar baz"
</code></pre></div></div> <p>List elements can be sliced using the same [start:end] syntax as in Python. If start or end is omitted, it is assumed to be the 0 or len(list), respectively.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo = ["one", "two", "three"]
print foo[1:]
&gt;&gt;&gt; two three
print foo[:2]
&gt;&gt;&gt; one two
print foo[:-1]
&gt;&gt;&gt; one two
</code></pre></div></div> <h2 id="math"> <a href="#math" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Math </h2> <p>You can perform basic arithmetic on integer and float variables. Available operations are:</p> <ul> <li><code class="language-plaintext highlighter-rouge">+</code> add</li> <li><code class="language-plaintext highlighter-rouge">-</code> subtract</li> <li><code class="language-plaintext highlighter-rouge">*</code> multiplication</li> <li><code class="language-plaintext highlighter-rouge">/</code> divide (integer division if on an integer)</li> <li><code class="language-plaintext highlighter-rouge">%</code> remainder</li> <li><code class="language-plaintext highlighter-rouge">**</code> power (2**3 = 8)</li> </ul> <p>Operations are performed in standard order; however, you can also add also parentheses around clauses to process things in a different order. For example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>8 + 2 * 10 = 28
(8 + 2) * 10 = 100
8 + (2 * 10) = 28
</code></pre></div></div> <h2 id="logic"> <a href="#logic" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Logic </h2> <p>You can perform basic logic operations as well. This will most commonly be used in the context of an if-else condition.</p> <ul> <li><code class="language-plaintext highlighter-rouge">&amp;&amp;</code> and</li> <li><code class="language-plaintext highlighter-rouge">||</code> or</li> <li><code class="language-plaintext highlighter-rouge">!</code> not (or is unset)</li> <li><code class="language-plaintext highlighter-rouge">==</code> equals</li> <li><code class="language-plaintext highlighter-rouge">!=</code> not equals</li> <li><code class="language-plaintext highlighter-rouge">&lt;</code> less than</li> <li><code class="language-plaintext highlighter-rouge">&lt;=</code> less than or equals</li> <li><code class="language-plaintext highlighter-rouge">&gt;</code> greater than</li> <li><code class="language-plaintext highlighter-rouge">&gt;=</code> greater than or equals</li> </ul> <p>You can chain these together to form more complex conditions. For example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo = "bar"
baz = 12

if foo == "bar" &amp;&amp; baz &lt; 20
    print "test"
endif
</code></pre></div></div> <h2 id="variable-substitution"> <a href="#variable-substitution" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Variable substitution </h2> <p>Inside of strings, variables can be substituted. Each string (including build script snippets) will be evaluated for variable substitutions.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${var}          - Variable named "var". If "var" is a list, ${var} will
                  be replaced with a space-separated string with all
                  members of the list. **If "var" hasn't been set, then this
                  will throw a ParseError exception.**

${var?}         - Optional variable substitution. This is the same as
                  above, except that if "var" hasn't been set, then it
                  will be replaced with an empty string: ''.

foo_@{var}_bar  - A replacement list, capturing the surrounding context.
                  For each member of list, the following will be returned:
                  foo_one_bar, foo_two_bar, foo_three_bar, etc...

foo_@{n..m}_bar - A replacement range, capturing the surrounding context.
                  For each member of range ({n} to {m}, the following will
                  be returned: foo_1_bar, foo_2_bar, foo_3_bar, etc...

                  {n} and {m} may be variables or integers
</code></pre></div></div> <h2 id="shell-escaping"> <a href="#shell-escaping" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Shell escaping </h2> <p>You may also include the results from shell commands as well using the syntax <code class="language-plaintext highlighter-rouge">$(command)</code>. Anything surrounded by <code class="language-plaintext highlighter-rouge">$()</code> will be executed in the current shell. Anything written to stdout can be captured as a variable. The shell command will be evaluated as a CGPipe string and any variables substituted.</p> <p>Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>submit_host = $(hostname)
submit_date = $(date)
</code></pre></div></div> <p>Shell escaping can also be used within strings, such as:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print "The current time is: $(date)"
</code></pre></div></div> <h2 id="printing"> <a href="#printing" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Printing </h2> <p>You can output arbitrary messages using the "print" statement. The default output is stdout, but this can be silenced using the <code class="language-plaintext highlighter-rouge">-s</code> command-line argument.</p> <p>Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print "Hello world"

foo = "bar"
print "foo${bar}"
</code></pre></div></div> <h2 id="ifelseendif"> <a href="#ifelseendif" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> If/Else/Endif </h2> <p>Basic syntax:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if [condition]
   do something...
elif [condition]
   do something...
else
   do something else...
endif
</code></pre></div></div> <h3 id="conditions"> <a href="#conditions" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Conditions </h3> <p><code class="language-plaintext highlighter-rouge">if foo</code> - if the variable ${foo} was set <code class="language-plaintext highlighter-rouge">if !foo</code> - if the variable ${foo} was not set or is false</p> <p><code class="language-plaintext highlighter-rouge">if foo == "bar"</code> - if the variable <code class="language-plaintext highlighter-rouge">foo</code> equals the string "bar" <code class="language-plaintext highlighter-rouge">if foo != "bar"</code> - if the variable <code class="language-plaintext highlighter-rouge">foo</code> doesn't equal the string "bar"</p> <p><code class="language-plaintext highlighter-rouge">if foo &lt; 1</code> <br /> <code class="language-plaintext highlighter-rouge">if foo &lt;= 1</code> <br /> <code class="language-plaintext highlighter-rouge">if foo &gt; 1</code> <br /> <code class="language-plaintext highlighter-rouge">if foo &gt;= 1</code></p> <h2 id="for-loops"> <a href="#for-loops" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> For loops </h2> <p>Basic syntax:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i in {start}..{end}
   do something...
done

for i in 1..10
    do something...
done

for i in list
   do something...
done
</code></pre></div></div> <h2 id="build-target-definitions"> <a href="#build-target-definitions" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Build target definitions </h2> <p>Targets are the files that you want to create. They are defined on a single line listing the outputs of the target, a colon (:), and any inputs that are needed to build the outputs.</p> <p>Any text (indented) after the target definition will be included in the script used to build the outputs. The indentation for the first line will be removed from all subsequent lines, in case there is a need for indentation to be maintained. The indentation can be any number of tabs or spaces. The first (non-blank) line that is at the <em>same</em> indentation level as the target definition line marks the end of the target definition.</p> <p>CGPipe expressions can also be evaluated within the target definition. These will only be evaluated if the target needs to be built and can be used to dynamically alter the build script. Any variables that are defined within the target can only be used within the target. Any global variables are captured at the point <em>when the target is defined</em>. Global variables may not altered within a target, but they can be reset within the context of the target itself.</p> <p>Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>output1.txt.gz output2.txt.gz : input1.txt input2.txt
    gzip -c input1.txt &gt; output1.txt.gz
    gzip -c input2.txt &gt; output2.txt.gz
</code></pre></div></div> <p>You may also have more than one target definition for any given output file(s). In the event that there is more than one way to build an ouput, the first listed build definition will be tried first. If the needed inputs (or dependencies) aren't available for the first definition, then the next will be tried until all methods are exhausted.</p> <p>In the event that a complete build tree can't be found, a ParseError will be thrown.</p> <h3 id="wildcards-in-targets"> <a href="#wildcards-in-targets" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Wildcards in targets </h3> <p>Using wildcards, the above could also be rewritten like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%.gz: %
    gzip -c $&lt; &gt; $&gt;
</code></pre></div></div> <p>Note: The '%' is only valid as a wildcard placeholder for inputs / outputs. To use the wildcard in the body of the target, use <code class="language-plaintext highlighter-rouge">$%</code>.</p> <h3 id="target-substitutions"> <a href="#target-substitutions" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Target substitutions </h3> <p>In addition to global variable substitutions, within a target these additional substitutions are available. Targets may also have their own local variables.</p> <p>Note: For global variables, their values are captured when a target is defined.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$&gt;              - The list of all outputs
$&gt;num           - The {num}'th output (starts at 1)

$&lt;              - The list of all inputs
$&lt;num           - The {num}'th input (starts at 1)

$%              - The wildcard match
</code></pre></div></div> <h3 id="special-targets"> <a href="#special-targets" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Special targets </h3> <p>There are five special target names that can be added for any pipeline: <code class="language-plaintext highlighter-rouge">__pre__</code>, <code class="language-plaintext highlighter-rouge">__post__</code>, <code class="language-plaintext highlighter-rouge">__setup__</code>, <code class="language-plaintext highlighter-rouge">__teardown__</code>, and <code class="language-plaintext highlighter-rouge">__postsubmit__</code>. These are target definitions that accept no input dependencies. <code class="language-plaintext highlighter-rouge">__pre__</code> is automatically added to the start of the body for all targets. <code class="language-plaintext highlighter-rouge">__post__</code> is automatically added to the end of the body for all targets. <code class="language-plaintext highlighter-rouge">__setup__</code> and <code class="language-plaintext highlighter-rouge">__teardown__</code> will always run as the first and last job in the pipeline. <code class="language-plaintext highlighter-rouge">__postsubmit__</code> is a new job that is run after each other job has been submitted. There will be only one <code class="language-plaintext highlighter-rouge">__teardown__</code> job for the entire pipeline, but a separate <code class="language-plaintext highlighter-rouge">__postsubmit__</code> job for each other job submitted. <code class="language-plaintext highlighter-rouge">__postsubmit__</code> is <strong>always</strong> a shexec block and can be used to add monitoring based on the newly submitted job-id. For example, if you'd like to keep track of jobs that were submitted, this could be used to add the new job's info (and job-id) to a database.</p> <p>You can selectively disable <code class="language-plaintext highlighter-rouge">__pre__</code> and <code class="language-plaintext highlighter-rouge">__post__</code> for any job by setting the variable <code class="language-plaintext highlighter-rouge">job.nopre</code> and <code class="language-plaintext highlighter-rouge">job.nopost</code>.</p> <h2 id="including-other-files"> <a href="#including-other-files" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Including other files </h2> <p>Other Pipeline files can be imported into the currently running Pipeline by using the <code class="language-plaintext highlighter-rouge">include filename</code> statement. In this case, the directory of the current Pipeline file will be searched for 'filename'. If it isn't found, then the current working directory will be searched. If it still isn't found, then an ParseError will be thrown.</p> <h2 id="logging"> <a href="#logging" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Logging </h2> <p>You can define a log file to use within the Pipeline file. You can do this with the <code class="language-plaintext highlighter-rouge">log filename</code> directive. If an existing log file is active, then it will be closed and the new log file used. By default all output from the Pipeline will be written to the last log file specified.</p> <p>You may also specify a log file from the command-line with the <code class="language-plaintext highlighter-rouge">-l logfile</code> command-line argument.</p> <h2 id="output-logs"> <a href="#output-logs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Output logs </h2> <p>You can keep track of which files are scheduled to be created using an output log. Do use this, you'll need to set the <code class="language-plaintext highlighter-rouge">cgpipe.joblog</code> variable. If you set a joblog, then in addition to checking the local filesystem to see if a target already exists, the joblog will also be consulted. This file keeps track of outputs that have already been submitted to the job scheduler. CGPipe will also check with the job runner, to verify that the job is still valid (running or queued).</p> <p>This way you can avoid re-submitting the same jobs over and over again if you re-run the pipeline. This output log enables the ability to have multiple pipelines coordinate common dependencies or chaining without requiring an external management daemon. This also allows you to write smaller separate (composable) pipelines instead of large monolithic ones.</p> <h2 id="comments"> <a href="#comments" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Comments </h2> <p>Comments are started with a <code class="language-plaintext highlighter-rouge">#</code> character. You may also include the '$' and '@' characters in strings or evaluated lines by escaping them with a '' character before them, such as <code class="language-plaintext highlighter-rouge">\$</code>. If they will be evaluated twice, you will need to escape them twice (as is the case with shell evaluated strings).</p> <h2 id="help-text"> <a href="#help-text" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Help text </h2> <p>The user can request to disply help/usage text for any given pipeline. Any comment lines at the start of the file will be used as the help/usage text. The first non-comment line (including blank lines) will terminate the help text. If the script starts with a shebang (#!), then that line will not be included in the help text.</p> <p>Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/env cgpipe
#
# This is a pipeline
#
# Options:
#    --gzip              compress output
#    --input filename    input filename
#
# (end of the help text)

...

# rest of the script
</code></pre></div></div> <h2 id="job-execution-options"> <a href="#job-execution-options" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Job execution options </h2> <h3 id="specifying-the-shell-to-use"> <a href="#specifying-the-shell-to-use" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Specifying the shell to use </h3> <p>CGPipe will attempt to find the correct shell interpreter to use for executing scripts. By default it will look for <code class="language-plaintext highlighter-rouge">/bin/bash</code>, <code class="language-plaintext highlighter-rouge">/usr/bin/bash</code>, <code class="language-plaintext highlighter-rouge">/usr/local/bin/bash</code>, or <code class="language-plaintext highlighter-rouge">/bin/sh</code> (in order of preference). Alternatively, you may set the config value <code class="language-plaintext highlighter-rouge">cgpipe.shell</code> in the <code class="language-plaintext highlighter-rouge">$HOME/.cgpiperc</code> file to set a specific shell binary.</p> <p>The shell may also be chosen on a per-job basis by setting the <code class="language-plaintext highlighter-rouge">job.shell</code> variable for each job.</p> <h3 id="direct-execution-of-jobs"> <a href="#direct-execution-of-jobs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Direct execution of jobs </h3> <p>Certain jobs can also be directly executed as part of the pipeline building process. Instead of submitting these jobs to a scheduler, the jobs can be put into a temporary shell script and executed directly. The global shell will be used to run the script. Only jobs without any dependencies can be executed in this manner. If you would like a job to just run directly without being scheduled, set the variable <code class="language-plaintext highlighter-rouge">job.shexec=true</code>. Also, the <code class="language-plaintext highlighter-rouge">__setup__</code> and <code class="language-plaintext highlighter-rouge">__teardown__</code> can be executed as <code class="language-plaintext highlighter-rouge">shexec</code>.</p> <p>One use for this is to setup any output folders that may be required. For example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>__setup__:
    &lt;% job.shexec = true %&gt;
    mkdir -p output
</code></pre></div></div> <p>Another common use-case for this is having a <code class="language-plaintext highlighter-rouge">clean</code> target to remove all output files to perform a fresh set of calculations. For example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clean:
    &lt;% job.shexec = true %&gt;
    rm *.bam
</code></pre></div></div> <h1 id="experimental-cgpipe-language-features"> <a href="#experimental-cgpipe-language-features" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Experimental cgpipe language features </h1> <p>The following features are experimental. Syntax for the below may change in future versions of CGPipe (or be removed entirely).</p> <h2 id="target-snippets-imports"> <a href="#target-snippets-imports" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Target snippets imports </h2> <p>Sometimes you might have more than one target definition that has the same (or similar) job body. In this case, you might want to have only one copy of the source snippet and import that copy into each separate build-target script.</p> <p>You can do this with an "importable" target definition. This is one way to include a common snippet into a target script that isn't <code class="language-plaintext highlighter-rouge">__pre__</code> or <code class="language-plaintext highlighter-rouge">__post__</code>. Importable target definitions are targets that have only one output (the name), followed by two colons. That snippet can then be imported into the body of a target definition using the <code class="language-plaintext highlighter-rouge">import</code> statement.</p> <p>(Note: the <code class="language-plaintext highlighter-rouge">import</code> statement only works within the context of a build-target. If you need something like import in a Pipeline, try the <code class="language-plaintext highlighter-rouge">include</code> statement.)</p> <p>Here's an example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>common::
    echo "this is the common snippet"
    
out.txt: input.txt
    &lt;% import common %&gt;

out2.txt: input2.txt
    &lt;% import common %&gt;
</code></pre></div></div> <h2 id="eval-statement"> <a href="#eval-statement" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Eval statement </h2> <p>The eval statment lets us eval a string at runtime</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>i=1
a="i=i+1"
eval a

i =&gt; 2
</code></pre></div></div> <h2 id="double-evaluated-variables"> <a href="#double-evaluated-variables" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Double evaluated variables </h2> <p>Double var eval is useful in targets to include chunks of text based on a var:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo="echo \"$&gt;\""

target: 
    $ 
</code></pre></div></div> <p>will result in this being added to the body:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "target"
</code></pre></div></div> </div> </div> </div> </div> </body> </html>
